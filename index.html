<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="apple-touch-icon" href="apple-touch-icon.png">
        <!-- Place favicon.ico in the root directory -->

        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="css/main.css">
        <script src="https://code.jquery.com/jquery-1.12.0.min.js"></script>
        <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.12.0.min.js"><\/script>')</script>
        <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js"></script>
        <script src="js/gmaps.js"></script>
        <script src="js/plugins.js"></script>
        <script src="js/main.js"></script>
        <script src="js/vendor/modernizr-2.8.3.min.js"></script>

    </head>
    <body>
        <script type="text/javascript">
            $(document).ready(function(){
              map = new GMaps({
                div: '#map',
                lat: 50.761509,
                lng: 4.448740,
                zoom: 8,
                zoomControl : true,
                zoomControlOpt: {
                    style : 'SMALL',
                    position: 'TOP_LEFT'
                },
                panControl : false,
                streetViewControl : false,
                mapTypeControl: false,
                overviewMapControl: false
              });
              $('#geocoding_form').submit(function(e){
                e.preventDefault();

                GMaps.geocode({
                  address: $('#address').val().trim(),
                  callback: function(results, status){
                    if(status=='OK'){
                      var latlng = results[0].geometry.location;
                      map.setCenter(latlng.lat(), latlng.lng());
                      map.addMarker({
                        lat: latlng.lat(),
                        lng: latlng.lng()
                      });
                      var lat =latlng.lat();
                      var long = latlng.lng();
                      getGeo(lat,long);                    
                    }
                  }
                });
              });
            });
        </script>
        <script>
            //----------------------------
            // build and make request with coordinates / return results to DOM  / fixed max distance

           function getGeo(lat,long){
            var georequest = "http://api.geowacht.be/api-v3/json/pharmacies/near_coordinate?longitude="+long+"&latitude="+lat+"&max_distance=30"

            $.getJSON(georequest, function(data){
            var results = data.results;

                $.each(results, function(key, val){
                    $ (".apoResult").append("<h1>" + val.pharmacy.name);
                    $ (".apoResult").append("<h3>" + val.pharmacy.address_street + " "+ val.pharmacy.address_streetnr + ", " + val.pharmacy.address_postalcode + " " + val.pharmacy.address_locality);
            });
            });
            }
        </script>

      <div id="map"></div>
            <form method="post" id="geocoding_form">
                <label for="address">Stad</label>
                <div class="input">
                <input type="text" id="address" name="address">
                <input type="submit" class="btn" value="Search">
                </div>
            </form>
      <div class="apoResult"></div>

    </body>
</html>
